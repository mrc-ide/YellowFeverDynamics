---
title: "Vignette 3 - Running Model"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette 3 - Running Model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette demonstrates how to set up and carry out a single run of the model for a single region. 

First load the package:

```{r}
library(YellowFeverDynamics)
```

Population and vaccination data is stored in a list object as described in Vignette 2. Here an example data set for multiple regions is loaded and the vaccination and population data for the first included region is extracted:

```{r}
input_data <- readRDS(file=paste(path.package("YellowFeverDynamics"),"/exdata/input_data_example.Rds",sep=""))
vacc_data=input_data$vacc_data[1,,]
pop_data=input_data$pop_data[1,,]  
```

The other input parameters to the functions which run the model are as follows:

```{r}
FOI_spillover=1.0e-8            # Force of infection due to spillover from sylvatic reservoir
R0=1.5                          # Reproduction number for urban spread of infection
year0=1940                      # First year in population/vaccination data
mode_start=1                    # Flag indicating how to set initial population immunity level in addition to vaccination
                                # If mode_start=0, only vaccinated individuals
                                # If mode_start=1, shift some non-vaccinated individuals into recovered to give herd immunity
                                # If mode_start=2, use SEIRVC input in list from previous run(s)
n_particles=10                   # Number of particles to run
n_threads=1                     # Number of threads to run
year_end=2001                   # Year at which to stop generating data (year after last year where data is desired)
year_data_begin=1999            # Year to begin saving data
vaccine_efficacy=1.0            # Proportional vaccine efficacy
start_SEIRV=NULL                # SEIRV data from end of a previous run to use as input (if mode_start=2)
dt=5.0                          # Time increment in days to use in model (should be either 1.0 or 5.0 days
```

The Full_Model_Run function is normally used to run the model for the inputs above:

```{r}
test1<-Full_Model_Run(FOI_spillover,R0,vacc_data,pop_data,year0,mode_start,n_particles,n_threads,year_end,
                     year_data_begin,vaccine_efficacy,start_SEIRV,dt)
```

The output of Full_Model_Run includes, for each repetition, date information, the total force of infection FOI_total at each data point, the numbers of susceptible (S), exposed (E), infectious (I), recovered (R) and vaccinated (V) people at each time point and the number of new infections (C) at each time point organized by age group.

```{r}
plot<-plot_model_output(test1)
print(plot)
```

For some applications, the Basic_Model_Run function can be used instead. This is identical to Full_Model_Run but does not output the total force of infection at each time point or the number of new infections at each time point.

```{r,eval=FALSE}
test2<-Basic_Model_Run(FOI_spillover,R0,vacc_data,pop_data,year0,mode_start,n_particles,n_threads,year_end,
                     year_data_begin,vaccine_efficacy,start_SEIRVC,dt)
```
