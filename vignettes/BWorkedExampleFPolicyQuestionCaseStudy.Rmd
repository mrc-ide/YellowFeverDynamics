---
title: "Worked Example 6 - Policy Question Case Study"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Worked Example 6 - Policy Question Case Study}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This worked example demonstrates how the package can be used to carry out calculations aimed at answering a specific policy question.

In the scenario presented here, we consider an imaginary country named Imaginaryland with 25 administrative sub-divisions which all have the same population but different values of relevant environmental covariates. Imaginaryland currently (20XX) has no vaccination against yellow fever, but is expected to begin vaccination of infants (age 0-1) for yellow fever in 20XX+1, with a coverage of 80% in every region. A vaccination campaign covering 50% of people over the age of 1 is also planned to take place in the same year.

The policy questions we want to answer are:

* How many deaths will be prevented (in each region and in total across the entire country) between 20XX+1 and 20YY due to the vaccination campaign in 20XX+1 and infant vaccination in that year and subsequent years, compared to a scenario where no vaccination is carried out at all?
* If the campaign to vaccinate people over age 1 is delayed for 1 year (to 20XX+2) or 2 years (20XX+3), how many additional deaths will occur compared to the planned scenario where the campaign takes place in 20XX+1 at the same time as the start of infant vaccination?

The code below loads and plots maps of the environmental covariate values for the 25 sub-divisions of Imaginaryland:

```{r,eval=FALSE}
library(YellowFeverDynamics)
enviro_data <- read.csv(file = paste(path.package("YellowFeverDynamics"), "/exdata/enviro_data_example.csv", sep = ""),
                        header = TRUE) # Environmental data
regions=enviro_data$region
n_regions <- nrow(enviro_data)
n_env_vars=ncol(enviro_data)-1
shape_data <- map_shapes_load(regions, shapefiles=c(paste(path.package("YellowFeverDynamics"),
                                                          "/exdata/shapefile_example.shp", sep = "")),
                              region_label_type="GID_1") # Shapefile
colour_scheme=readRDS(file=paste(path.package("YellowFeverDynamics"), "/exdata/colour_scheme_example.Rds", sep="/"))
colour_scale=colour_scheme$colour_scale
for(i in 1:n_env_vars){
  null1 <- create_map(shape_data, enviro_data[,i+1], scale=pretty(enviro_data[,i+1], 5), colour_scale, pixels_max=720,
                    text_size=0.75, map_title="", legend_title=colnames(enviro_data[i+1]),
                    legend_position="topleft",legend_format="f",
                    legend_dp=0, output_file=NULL)
}
```

A single set of coefficients of the environmental covariates has been previously obtained via MCMC estimation based on available epidemiological data (from Imaginaryland itself and/or from other regions where suitable data is available). The code below (also displayed in [Guide 2 - Calculating Parameters From Environmental Data](https://mrc-ide.github.io/YellowFeverDynamics/articles/CGuideBParametersEnvironment.html)) calculates values of spillover force of infection and basic reproduction number for human-human transmission and plots maps of them:

```{r,eval=FALSE}
enviro_coeffs <- read.csv(file = paste(path.package("YellowFeverDynamics"), "/exdata/enviro_coeffs_example.csv", 
                                       sep = ""), header = TRUE)
epi_data <- data.frame(region = enviro_data$region, FOI = rep(NA, n_regions), R0 = rep(NA, n_regions))
for(n_region in 1:n_regions){
 FOI_R0_values <- param_calc_enviro(enviro_coeffs = enviro_coeffs[1, ], 
                                    enviro_covar_values = enviro_data[n_region,c(2:ncol(enviro_data))])
 epi_data$FOI[n_region] <- FOI_R0_values$FOI
 epi_data$R0[n_region] <- FOI_R0_values$R0
}
null1 <- create_map(shape_data, epi_data$FOI, scale=pretty(epi_data$FOI, 8), colour_scale, pixels_max=720,
                    text_size=0.75, map_title="", legend_title="FOI", legend_position="topleft", legend_format="e",
                    legend_dp=1, output_file=NULL)
null2 <- create_map(shape_data, epi_data$R0, scale=pretty(epi_data$R0, 8), colour_scale, pixels_max=720, text_size=0.75,
                    map_title="", legend_title="R0", legend_position="topleft", legend_format="f", legend_dp=1,
                    output_file=NULL)
```
